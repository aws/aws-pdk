#!/bin/bash

set -e

# Parse arguments
spec_path=''
output_path=''
while [[ "$#" -gt 0 ]]; do case $1 in
  --spec-path) spec_path="$2"; shift;;
  --output-path) output_path="$2"; shift;;
esac; shift; done

echo "Generating HTML Redoc documentation..."

working_dir=$(pwd)

# Create a temporary directory
tmp_dir=$(mktemp -d "${TMPDIR:-/tmp/}generate-docs-html-redoc.XXXXXXXXX")
cd $tmp_dir

# Preference: pnpm > yarn > npm. Use if available, otherwise fall back to npm so as not to require it as a system-wide dependency
pkg_manager=pnpm
pkg_install_cmd=install
if ! $pkg_manager -v &> /dev/null; then
  pkg_manager=yarn
  pkg_install_cmd=add
  if ! $pkg_manager -v &> /dev/null; then
    pkg_manager=npm
    pkg_install_cmd=install
  fi
fi

# Install dependencies
$pkg_manager $pkg_install_cmd --silent redoc-cli@0.13.20

# Generate
npx redoc-cli build $spec_path --output $output_path

echo "HTML Redoc documentation generation done!"

# Clean up
cd $working_dir
rm -rf $tmp_dir
