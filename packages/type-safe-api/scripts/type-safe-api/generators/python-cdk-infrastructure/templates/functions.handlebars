###TSAPI_SPLIT_FILE###
###TSAPI_WRITE_FILE###
{
  "dir": ".",
  "name": "functions",
  "ext": ".py",
  "overwrite": true
}
###/TSAPI_WRITE_FILE###from aws_cdk import Duration
from aws_cdk.aws_lambda import (
    Function, Runtime, Tracing, Code
)
from aws_pdk.type_safe_api import SnapStartFunction
from os import path
from pathlib import Path

{{#apiInfo ~}}
{{#apis ~}}
{{#operations ~}}
{{#operation ~}}
{{#if vendorExtensions.x-handler}}

class {{operationIdCamelCase}}Function({{#startsWith vendorExtensions.x-handler.language 'java' ~}}SnapStart{{~/startsWith}}Function):
    """
    Lambda function construct which points to the {{vendorExtensions.x-handler.language}} implementation of {{operationIdCamelCase}}
    """
    def __init__(self, scope, id, **kwargs):
        super().__init__(scope, id,
            {{#startsWith vendorExtensions.x-handler.language 'typescript' ~}}
            runtime=Runtime.{{#apiInfo}}{{#apis.0}}{{vendorExtensions.x-handlers-node-lambda-runtime-version}}{{/apis.0}}{{/apiInfo}},
            {{~/startsWith}}{{#startsWith vendorExtensions.x-handler.language 'python' ~}}
            runtime=Runtime.{{#apiInfo}}{{#apis.0}}{{vendorExtensions.x-handlers-python-lambda-runtime-version}}{{/apis.0}}{{/apiInfo}},
            {{~/startsWith}}{{#startsWith vendorExtensions.x-handler.language 'java' ~}}
            runtime=Runtime.{{#apiInfo}}{{#apis.0}}{{vendorExtensions.x-handlers-java-lambda-runtime-version}}{{/apis.0}}{{/apiInfo}},
            {{~/startsWith}}
            {{#startsWith vendorExtensions.x-handler.language 'typescript' ~}}
            handler="index.handler",
            {{~/startsWith}}{{#startsWith vendorExtensions.x-handler.language 'python' ~}}
            handler="{{#apiInfo}}{{#apis.0}}{{vendorExtensions.x-handlers-python-module}}{{/apis.0}}{{/apiInfo}}.{{operationIdSnakeCase}}.handler",
            {{~/startsWith}}{{#startsWith vendorExtensions.x-handler.language 'java' ~}}
            handler="{{#apiInfo}}{{#apis.0}}{{vendorExtensions.x-handlers-java-package}}{{/apis.0}}{{/apiInfo}}.{{operationIdCamelCase}}Handler",
            {{~/startsWith}}
            code=Code.from_asset(path.join(str(Path(__file__).absolute().parent), "..",
                {{#startsWith vendorExtensions.x-handler.language 'typescript' ~}}
                "{{#apiInfo}}{{#apis.0}}{{vendorExtensions.x-handlers-typescript-asset-path}}{{/apis.0}}{{/apiInfo}}",
                "###TSAPI_FN###{ "function": "kebabCase", "args": ["{{operationIdCamelCase}}"] }###/TSAPI_FN###",
                {{~/startsWith}}{{#startsWith vendorExtensions.x-handler.language 'python' ~}}
                "{{#apiInfo}}{{#apis.0}}{{vendorExtensions.x-handlers-python-asset-path}}{{/apis.0}}{{/apiInfo}}",
                {{~/startsWith}}{{#startsWith vendorExtensions.x-handler.language 'java' ~}}
                "{{#apiInfo}}{{#apis.0}}{{vendorExtensions.x-handlers-java-asset-path}}{{/apis.0}}{{/apiInfo}}",
                {{~/startsWith}}
            )),
            tracing=Tracing.ACTIVE,
            timeout=Duration.seconds(30),
            **kwargs,
        )

{{~/if}}
{{~/operation}}
{{~/operations}}
{{~/apis}}
{{~/apiInfo}}